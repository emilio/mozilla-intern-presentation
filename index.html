<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Emilio Cobos Álvarez [:emilio]">
  <title>Stylo</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="reveal.js/css/reveal.css">
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <!-- <link rel="stylesheet" href="reveal.js/css/theme/solarized.css" id="theme"> -->
  <link rel="stylesheet" href="custom.css">
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
  <h1 class="title">Stylo</h1>
  <h1 class="subtitle">Servo's style system in Gecko</h1>
  <h2 class="author">Emilio Cobos Álvarez [:emilio]</h2>
</section>

<section id="aboutemilio" class="slide level1">
<h1><code>about:emilio</code></h1>
<ul>
<li>Undergrad student from Salamanca (Spain).</li>
<li class="fragment">Platform intern this summer.</li>
<li class="fragment">Servo contributor for more than a year.
<ul>
<li>WebGL, style, layout, review stuff...</li>
<li>Also maintain and improve Servo's fork of rust-bindgen.</li>
</ul></li>
</ul>
</section>
<section id="stylo" class="slide level1">
<h1>Stylo</h1>
<p>Integrating Servo's style system, written in Rust, inside Gecko.</p>
<figure>
<img src="img/stylo.png" alt="Stylo screenshot as of 28th of August of 2016" /><figcaption>Stylo screenshot as of 28th of August of 2016</figcaption>
</figure>
</section>
<section id="background" class="slide callout level1">
<h1>Background</h1>
</section>
<section id="rust" class="slide level1">
<h1>Rust</h1>
<figure>
<img src="img/rust.png" alt="Rust&#39;s logo" /><figcaption>Rust's logo</figcaption>
</figure>
<ul>
<li>New(ish) systems programming language, born at Mozilla.</li>
<li class="fragment">More safety guarantees than C++, without compromising performance.</li>
<li class="fragment">No data races.</li>
</ul>
</section>
<section id="servo" class="slide level1">
<h1>Servo</h1>
<figure>
<img src="img/servo.png" alt="Servo logo" /><figcaption>Servo logo</figcaption>
</figure>
<ul>
<li>Next generation web-browser engine, designed for modern hardware.</li>
<li class="fragment">Not totally web compatible right now, but some components are stable
  enough.</li>
</ul>
</section>
<section id="motivations" class="slide level1">
<h1>Motivations</h1>
<figure>
<img src="img/Oxidation.svg" alt="Oxydation logo" /><figcaption>Thanks Potch!</figcaption>
</figure>
<ul>
  <li>Modernize aging parts of the platform.</li>
  <li class="fragment">Take advantage of Rust's safety guarantees.</li>
  <li class="fragment">Take advantage of Servo's parallel design</li>
</ul>
</section>
<section id="challenges" class="slide callout level1">
<h1>Challenges</h1>
</section>
<section id="language-boundaries-section" class="slide level1">
<h1 id="language-boundaries">Language boundaries</h1>
<ul>
<li>Rust and C++ common denominator: C
<li class="fragment">OOL calls aren't free in performance-sensitive code.
</ul>
</section>
<section id="normally" class="slide level1">
  <h1>Normally...</h1>

<div class="sourceCode fragment"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">extern</span> <span class="st">&quot;C&quot;</span> {
    <span class="at">#[</span>no_mangle<span class="at">]</span>
    <span class="kw">pub</span> <span class="kw">unsafe</span> <span class="kw">fn</span> DoStuffFromRust(cpp_type: *<span class="kw">mut</span> CppType) -&gt; <span class="dt">u32</span>;
}</code></pre></div>
<div class="sourceCode fragment"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">class</span> CppType {
    <span class="co">// [Stuff]</span>
};

<span class="dt">extern</span> <span class="st">&quot;C&quot;</span> {
    <span class="dt">uint32_t</span> DoStuffFromRust(CppType*);
}</code></pre></div>
</section>
<section class="slide level1">
<h1 id="an-example">Instead...</h1>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="at">#[</span>repr<span class="at">(</span>C<span class="at">)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> nsStyleImageLayers {
    <span class="kw">pub</span> mAttachmentCount: <span class="dt">u32</span>,
    <span class="kw">pub</span> mClipCount: <span class="dt">u32</span>,
    <span class="kw">pub</span> mOriginCount: <span class="dt">u32</span>,
    <span class="kw">pub</span> mRepeatCount: <span class="dt">u32</span>,
    <span class="kw">pub</span> mPositionXCount: <span class="dt">u32</span>,
    <span class="kw">pub</span> mPositionYCount: <span class="dt">u32</span>,
    <span class="kw">pub</span> mImageCount: <span class="dt">u32</span>,
    <span class="kw">pub</span> mSizeCount: <span class="dt">u32</span>,
    <span class="kw">pub</span> mMaskModeCount: <span class="dt">u32</span>,
    <span class="kw">pub</span> mBlendModeCount: <span class="dt">u32</span>,
    <span class="kw">pub</span> mCompositeCount: <span class="dt">u32</span>,
    <span class="kw">pub</span> mLayers: nsStyleAutoArray&lt;nsStyleImageLayers_Layer&gt;,
}</code></pre></div>
</section>
<section id="different-styling-models" class="slide level1">
<h1>Different styling models</h1>
<ul>
<li>Servo:
<ul>
  <li class="fragment">Content tree.
</ul>
<li>Gecko:
<ul>
  <li class="fragment">Content tree.
  <li class="fragment">Frame tree.
  <li class="fragment">Rule tree.
  <li class="fragment">Style context tree.
</ul>
<aside class="notes">
  Mention in Servo each node owns its computed values, and its pseudo
  elements', that may be shared via refcounting.

  Gecko: Each content can have zero or N frames, frame holds the style context,
  that owns computed values.
</aside>
</ul>
</section>
<section id="geckos-layout-model" class="slide level1">
<h1>Gecko's layout model</h1>
<figure>
<img src="img/gecko-style-overview.gif" alt="Slide by Chris Waterson" /><figcaption>Slide by Chris Waterson</figcaption>
</figure>
</section>
<section id="current-approach" class="slide level1">
<h1>Current approach</h1>
<ul>
<li>Sequential pass after the parallel traversal.</li>
<li class="fragment">Nice for simplicity while developing, but we might want to refactor it
  (there are plans here).</li>
</ul>
</section>
<section id="links" class="slide level1">
<h1>Links!</h1>
<ul>
  <li>Tracking bug: <a href="https://bugzil.la/stylo">bugzil.la/stylo</a>.
  <li class="fragment">Wiki page: <a href="https://wiki.mozilla.org/Stylo">wiki.mozilla.org/Stylo</a>
  <li class="fragment">Build instructions: <a href="https://public.etherpad-mozilla.org/p/stylo">public.etherpad-mozilla.org/p/stylo</a>
  <li class="fragment">Old style system docs: <a href="http://www-archive.mozilla.org/newlayout/doc/style-techtalk.html">www-archive.mozilla.org/newlayout/doc/style-techtalk.html</a>
  <li class="fragment">Servo's style system docs: <code>servo/docs/components/style.md</code>
</section>
<section id="other-stuff-i-did" class="slide level1">
<h1>Other stuff I did</h1>
<ul>
  <li>34 Bugzilla bugs.
  <li class="fragment">Submitted 45 PRs to <code>servo/servo</code>, reviewed 71.
  <li class="fragment">Helped a few people to make their first contribution to
    Gecko or Servo, which feels <strong>awesome</strong>!
</ul>
</section>
<section id="thanks-to-all" class="slide level1">
<h1>People I need to thank for making my summer awesome.</h1>
<ul id="thanks-to"></ul>
<div id="thanks-mozilla"><img src="img/heart-mozilla.png"></div>
<script>
  function shuffle(arr) {
    var len = arr.length;
    while (len--) {
      var r = Math.floor(Math.random() * (len + 1));
      var tmp = arr[len];
      arr[len] = arr[r];
      arr[r] = tmp;
    }

    return arr;
  }

  var thanks_to = [
    "Bobby, Cameron, and all the Stylo team (they're great!).",
    "Johnny Stenback and Andrew Overholt.",
    "Daniel Holbert, Andrew McCreight, Bill McCloskey, Jeff Walden.",
    "All the MV interns (esp. Leo, Michael, Rob, Ryan).",
    "The University team.",
    "The Servo team (esp. Josh, Simon, Glenn).",
    "Boris Zbarsky and David Baron, for all their insight in different parts of" +
      " the platform."
  ];

  shuffle(thanks_to);

  thanks_to.push("A <strong>lot</strong> of other people...");

  document.getElementById("thanks-to").innerHTML = "<li>" +
    thanks_to.join("</li><li>") +
    "</li>";
</script>
</section>
    </div>
  </div>
  <script src="reveal.js/lib/js/head.min.js"></script>
  <script src="reveal.js/js/reveal.js"></script>
  <script>
      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({

        // Optional reveal.js plugins
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'reveal.js/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
